# This file has been generated by Chef
# -- Any changes will be overwritten after next run

import os.path
from sentry.conf.server import *

CONF_ROOT = os.path.dirname(__file__)

# Configure database credentials
DATABASES = {
    'default': {
        'ENGINE': '<%= @db_engine %>',
        'NAME': '<%= @db_name %>',
        'USER': '<%= @db_user %>',
        'PASSWORD': '<%= @db_password %>',
        'HOST': '<%= @db_host %>',
        'PORT': '<%= @db_port %>',
        'OPTIONS': <%= python_hash_string @db_options %>
    }
}

# TODO: allow to enable caches
# CACHES = {
#     'default': {
#         'BACKEND': 'django.core.cache.backends.memcached.MemcachedCache',
#         'LOCATION': ['127.0.0.1:11211'],
#     }
# }


SENTRY_USE_QUEUE = True
BROKER_URL = 'redis://localhost:6379'
SENTRY_BUFFER = 'sentry.buffer.redis.RedisBuffer'
SENTRY_REDIS_OPTIONS = {
    'hosts': {
        0: {
            'host': '127.0.0.1',
            'port': 6379,
        }
    }
}

SENTRY_PUBLIC = <%= @public ? 'True' : 'False' %>
SENTRY_ALLOW_REGISTRATION = <%= @allow_registration ? 'True' : 'False' %>

SENTRY_KEY = '<%= @signing_token %>'

SENTRY_URL_PREFIX = '<%= @url_prefix %>'  # No trailing slash!

SENTRY_WEB_HOST = '<%= @web_host %>'
SENTRY_WEB_PORT = <%= @web_port %>
SENTRY_WEB_OPTIONS = <%= python_hash_string @web_options %>

# Mail server configuration
SENTRY_SERVER_EMAIL = '<%= @email_default_from %>'
EMAIL_BACKEND = '<%= @email_backend %>'
EMAIL_HOST = '<%= @email_host %>'
EMAIL_PORT = <%= @email_port %>
EMAIL_USE_TLS = <%= @email_use_tls ? "True" : "False" %>
<% if @email_user -%>
EMAIL_HOST_USER = '<%= @email_user %>'
<% end -%>
<% if @email_password -%>
EMAIL_HOST_PASSWORD = '<%= @email_password %>'
<% end -%>
<% if @email_subject_prefix -%>
EMAIL_SUBJECT_PREFIX = '<%= @email_subject_prefix %>'
<% end -%>

<% if @additional_apps.any? -%>
INSTALLED_APPS = INSTALLED_APPS + (
  <%= @additional_apps.map{|app| "'#{app}'"}.join ",\n  "%>,
)
<% end %>

<% if @prepend_middleware_classes.any? -%>
MIDDLEWARE_CLASSES = (
  <%= @prepend_middleware_classes.map{|middleware| "'#{middleware}'"}.join ",\n  " %>,
) + MIDDLEWARE_CLASSES
<% end -%>
<% if @append_middleware_classes.any? -%>

MIDDLEWARE_CLASSES = MIDDLEWARE_CLASSES + (
  <%= @append_middleware_classes.map{|middleware| "'#{middleware}'"}.join ",\n  " %>,
)
<% end -%>
